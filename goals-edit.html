<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç›®æ¨™ã®ç·¨é›†</title>
  <link rel="stylesheet" href="goals.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ ç›®æ¨™ã‚’ç·¨é›†</h1>
    <a href="index.html" class="button">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>

    <div id="goalEditForm" style="margin: 20px;">
      <input type="text" id="goalTitle" placeholder="ç›®æ¨™ã‚¿ã‚¤ãƒˆãƒ«">
      <input type="text" id="goalCategory" placeholder="ã‚«ãƒ†ã‚´ãƒª">
      <input type="date" id="goalDeadline">
      <div id="goalExtraFields"></div>
      <button class="button" onclick="saveEditedGoal()">ä¿å­˜</button>
    </div>
  </div>

  <script>
    let goals = JSON.parse(localStorage.getItem("goals") || "[]");
    const editingGoal = JSON.parse(localStorage.getItem("editingGoal") || "null");

    if (!editingGoal) {
      alert("ç·¨é›†å¯¾è±¡ã®ç›®æ¨™ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
      location.href = "index.html";
    }

    document.getElementById("goalTitle").value = editingGoal.title;
    document.getElementById("goalCategory").value = editingGoal.category;
    document.getElementById("goalDeadline").value = editingGoal.deadline;

    const extraFields = document.getElementById("goalExtraFields");
    if (editingGoal.type === "quantitative") {
      extraFields.innerHTML = `
        <select id="goalTargetType">
          <option value="æ™‚é–“">æ™‚é–“</option>
          <option value="å›æ•°">å›æ•°</option>
        </select>
        <input type="number" id="goalTargetValue" placeholder="ç›®æ¨™å€¤">
      `;
      document.getElementById("goalTargetType").value = editingGoal.targetType;
      document.getElementById("goalTargetValue").value = editingGoal.targetValue;
    } else if (editingGoal.type === "checklist") {
      extraFields.innerHTML = `
        <textarea id="goalChecklistItems" placeholder="æ”¹è¡ŒåŒºåˆ‡ã‚Šã§ã‚¹ãƒ†ãƒƒãƒ—å…¥åŠ›"></textarea>
      `;
      document.getElementById("goalChecklistItems").value = editingGoal.items.map(i => i.text).join("\n");
    } else if (editingGoal.type === "free") {
      extraFields.innerHTML = `
        <textarea id="goalDescription" placeholder="è‡ªç”±è¨˜è¿°"></textarea>
      `;
      document.getElementById("goalDescription").value = editingGoal.description;
    }

    function saveEditedGoal() {
      const title = document.getElementById("goalTitle").value;
      const category = document.getElementById("goalCategory").value;
      const deadline = document.getElementById("goalDeadline").value;

      const index = goals.findIndex(g => g.id === editingGoal.id);
      if (index === -1) return;

      const updatedGoal = { ...editingGoal, title, category, deadline };

      if (editingGoal.type === "quantitative") {
        updatedGoal.targetType = document.getElementById("goalTargetType").value;
        updatedGoal.targetValue = parseFloat(document.getElementById("goalTargetValue").value);
      } else if (editingGoal.type === "checklist") {
        const lines = document.getElementById("goalChecklistItems").value.split("\n");
        updatedGoal.items = lines.map((text, i) => ({ text, done: editingGoal.items[i]?.done || false }));
      } else if (editingGoal.type === "free") {
        updatedGoal.description = document.getElementById("goalDescription").value;
      }

      goals[index] = updatedGoal;
      localStorage.setItem("goals", JSON.stringify(goals));
      localStorage.removeItem("editingGoal");
      alert("ç›®æ¨™ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚");
      location.href = "index.html";
    }
  </script>
</body>
</html>
